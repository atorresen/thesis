<html lang="en" dir="ltr">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no,width=device-width">
    <link rel="icon" href="foldicon.ico">
    <link rel="stylesheet" href="styles.css">
    <script src="data.js"></script>
    <title>fold</title>
</head>

<style>
    h2 {color: #777; margin-bottom: 2px;}
    p {font-size: 1rem;}
    input {font-family: monospace; font-size: 1.5rem; display: inline;}
</style>

<body>
    <div>
        <h2 style="color: #000; display: inline;">index:</h2>
        <input id="in" type="tel" oninput="f()"
            step="1" min="1" maxlength="3" size="4"
        ></input>
        <br>
        <h2>generator:</h2>
        <p id="gen" class="seqP" style="color: #777"> </p>
        <h2>result:</h2>
        <p id="res" class="seqP"></p>
        <h2>directions:</h2>
        <p id="dir" class="seqP"></p>
        <br>
        <canvas style="transform: rotate(180deg)" id="canvas" width="200" height="400"></canvas>
        <br><br>
        <p>info:</p>
        <a href="https://en.wikipedia.org/wiki/Kolakoski_sequence">Wikipedia -- Kolakoski sequence</a>
        <br><br>
        <a href="https://publications.risd.edu/grad-show-2026">RISD Grad Show</a>
        <br><br>
        <a href="https://atorresen.github.io/">AnneMarie</a>
    </div>
    <script type="text/javascript">
        document.getElementById("in").max = foldlists.length;

        function f() {
            // clear canvas
            let canvas = document.getElementById("canvas");
            let c = canvas.getContext("2d");
            c.beginPath();
            c.fillStyle = "#fff";
            c.fillRect(0, 0, canvas.width, canvas.height);
            
            // get data based on index
            let n = document.getElementById("in").value;
            let gen = genlists[n - 1];
            let res = foldlists[n - 1];
            let dir = [];
            let genP = document.getElementById("gen");
            let resP = document.getElementById("res");
            let dirP = document.getElementById("dir");

            // display results
            if (res == null) {
                genP.innerText = "";
                resP.innerText = "";
                dirP.innerText = "";
            } else {
                genP.innerText = gen;
                resP.innerText = res;
                
                // draw folds
                const scale = 20;
                const midline = canvas.width/2;
                let points = [ [midline, 1], [midline, 1 + scale * res[0]] ];
                for (let i = 1; i < res.length; i++) {
                    let last = points.slice(-1)[0];
                    let val = scale * res[i];
                    let m = [0,0];
                    if ( (i % 2) == 0 ) {
                        m = [0, val];
                    } else if ( last[0] > midline ) {
                        m = [-val, 0];
                    } else if ( last[0] < midline ) {
                        m = [val, 0];
                    } else if ( res[i] == 1 ) {
                        m = [-val, 0];
                    } else {
                        m = [val, 0];
                    };
                    points.push([ last[0] + m[0], last[1] + m[1] ]);
                };
                canvas.height = points[points.length - 1][1] + 1;
                c.moveTo(points[0][0], points[0][1]);
                c.beginPath();
                for (i = 0; i < points.length; i++) {
                    c.lineTo(points[i][0], points[i][1]);
                };
                c.stroke();

                //  relative L/R directions
                for (let i = 0; i < points.length - 2; i++) {
                    let x1 = points[i][0];
                    let x2 = points[i + 1][0];
                    let x3 = points[i + 2][0];
                    let d;
                    if ( x1 == x2 ){
                        if ( x3 > x2 ) {
                           d = "L"
                        } else {
                            d = "R"
                        }
                    } else {
                        if ( x1 < x2 ) { 
                            d = "R"
                        } else {
                            d = "L"
                        }
                    };
                    dir.push(d)
                }
                dirP.innerText = dir;

                const inchesPerUnit = 2;

                let height = inchesPerUnit * (points[points.length - 1][1] - 1) / scale;

                let length = inchesPerUnit * res.reduce((a, b) => a + b);

                 // return: [
                    // list of fold directions,
                    // height, in inches, from top to bottom of folded wire
                    // length, in inches, of wire used to form folds (should be <= 72)
                //]

                return [dir, height, length]
            }
        };
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const index = urlParams.get("index");
        document.querySelector("input#in").value = index;
        f();

        function csvInfo() {
            let taglists = [
                ["index", "generator", "result", "directions", "folded height", "wire length", "ending orientation"],
                []
            ];
            let totalfoldedheight = 0;
            for (let i = 0; i < foldlists.length - 1; i++) {
                document.querySelector("input#in").value = i + 1;
                let res = f();
                let dir = res[0];
                totalfoldedheight += res[1];
                taglists.push([
                    i + 1,
                    genlists[i].join(" "),
                    foldlists[i].join(" "),
                    dir.join(" "),
                    res[1], // folded height
                    res[2] // wire length
                ]);
            };
            console.log(totalfoldedheight); // based on Mathematica model, aiming for 9638 inches
            console.log(foldlists.length); // total number of folded wire pieces
            let csvstring = "data:text/csv;charset=utf-8," + taglists.map(e => e.join(",")).join("\n");
            var encodedUri = encodeURI(csvstring);
            window.open(encodedUri);
        }
        // csvInfo();
    </script>
</body>

</html>